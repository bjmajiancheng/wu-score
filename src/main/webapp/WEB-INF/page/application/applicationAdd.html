<!DOCTYPE html>
<html lang="en">
<head>
    <title>#if(${addFlag}) 申请人信息填写 #else 修改申请人信息 #end</title>
    #parse("common/header.html")
</head>

<body>
#parse("common/banner.html")

<!-- 主体部分 -->
<div class="integral-main-box">

    <!-- 左部导航 -->
    #parse("common/lefter.html")
    <!-- </script> -->
    <!-- 中间二级导航 -->

    <!-- 内容展示区 -->
    <div class="integral-cont">
        <!-- 第二大部分 -->
        <!-- 表单部分 -->
        <!-- 示例title 面包屑导航 -->
        <div class="integral-grey-title-bar">
            <div class="title-bar-head">居住证积分</div>
            <div class="title-bar-after">#if(${addFlag}) 申请人信息填写 #else 修改申请人信息 #end</div>
        </div>
        <!-- 内容描述title -->
        <div class="integral-desc-title">
            #if(${addFlag}) 申请人信息填写 #else 修改申请人信息 #end
        </div>
        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-sfz">身份证信息</div>
        </div>
        <!-- 表单主体部分  用table实现布局 -->
        <div class="integral-cont-table-wrap">
            <form class="identityInfoForm" id="identityInfoForm">
                <input type="hidden" name="id" value="$!{identityInfo.id}" id="identityInfoId"/>
                <table class="integral-cont-table">
                    <tr>
                        <td class="color-red"></span>身份证号：</td>
                        <td>
                            <input class="integral-input w450" type="text" id="idNumber" name="idNumber" value="$!{identityInfo.idNumber}">
                            <!-- <div class="interal-main-btn m15">身份证上传</div> -->
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <div class="integral-idcard-img">
                                <img class="addImg pointer" src="${rc.contextPath}/$static.curr_ver()/img/IDcard1.png"
                                     onclick="integral.clickImg(this);" #if("$!{identityInfo.idCardPositive}" != "") style="display: none;" #end >
                                <img class="preview" id="preview" alt="" name="pic" width="152" height="100"
                                     #if("$!{identityInfo.idCardPositive}"=="") style="display:none;" #end src="$!{identityInfo.idCardPositive}"/>
                                <input name="idcard1" type="file" class="upload_input"
                                       onchange="integral.change(this)"/>
                                <div class="pointer title_click" onclick="integral.clickImg(this);">点击上传身份证正面</div>
                                <div class="title_idcard" style="display:none;">身份证正面</div>
                                <div class="del_idcard" onclick="integral.deleteImg(this)" style="display:none;"></div>

                                <input name="id_card_positive" type="hidden" value="$!{identityInfo.idCardPositive}"/>
                            </div>
                            <div class="integral-idcard-img">
                                <img class="addImg pointer" src="${rc.contextPath}/$static.curr_ver()/img/IDcard2.png"
                                     onclick="integral.clickImg(this);" #if("$!{identityInfo.idCardOpposite}" != "") style="display: none;" #end alt="">
                                <img class="preview" id="back" alt="" name="pic" width="152" height="100"
                                     #if("$!{identityInfo.idCardOpposite}"=="") style="display:none;" #end src="$!{identityInfo.idCardOpposite}"/>
                                <input name="idcard2" type="file" class="upload_input"
                                       onchange="integral.change(this)"/>
                                <div class="pointer title_click" onclick="integral.clickImg(this);">点击上传身份证反面</div>
                                <div class="title_idcard" style="display:none;">身份证反面</div>
                                <div class="del_idcard" onclick="integral.deleteImg(this)" style="display:none;"></div>

                                <input name="id_card_opposite" type="hidden" value="$!{identityInfo.idCardOpposite}"/>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</td>
                        <td>
                            <input class="integral-input w450" type="text" name="name" id="name" value="$!{identityInfo.name}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：</td>
                        <td>
                            <input class="input_radio" type="radio" name="sex" value="1" id="male" #if(${identityInfo.sex} == 1) checked #end>&nbsp;
                            <label for="male">男</label>
                            <input class="input_radio ml30" type="radio" name="sex" value="0" id="female" #if(${identityInfo.sex} == 2) checked #end>&nbsp;
                            <label for="female">女</label>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">出生日期：</td>
                        <td>
                            <input class="integral-input w450" type="text" name="birthday" id="birthday" value="$!{identityInfo.birthday}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄：</td>
                        <td>
                            <input class="integral-input w450" type="number" id="age" name="age" value="$!{identityInfo.age}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">民&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;族：</td>
                        <td>
                            <input class="integral-input w450" type="text" name="nation" id="nation" value="$!{identityInfo.nation}">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-hjqy">户籍迁移信息</div>
        </div>
        <!-- 表单主体部分  用table实现布局 -->
        <div class="integral-cont-table-wrap">
            <form class="houseMoveForm" id="houseMoveForm">
                <input type="hidden" name="id" value="$!{houseMoveModel.id}" />
                <table class="integral-cont-table">
                    <tr>
                        <td class="color-red">迁出地区：</td>
                        <td>
                            <select name="moveProvince" id="moveProvince" style="width:125px;">
                                <option value="0">请选择</option>
                            </select>
                            省
                            <select class="ml40" name="moveCity" id="moveCity" style="width:125px;">
                                <option value="0">请选择</option>
                            </select>
                            市
                            <select class="ml40" name="moveRegion" id="moveRegion" style="width:125px;">
                                <option value="0">请选择</option>
                            </select>
                            区
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">迁出地地址：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="moveAddress" id="moveAddress" value="$!{houseMoveModel.moveAddress}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">现户籍登记机关：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="moveRegisteredOffice"
                                   id="moveRegisteredOffice" value="$!{houseMoveModel.moveRegisteredOffice}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">现户口性质：</td>
                        <td>
                            <select name="houseNature" id="houseNature">
                                <!--<option value="0">请选择</option>-->
                                <option value="1">未落常住户口</option>
                                <option value="2">非农业家庭户口</option>
                                <option value="3">农业家庭户口</option>
                                <option value="4">非农业集体户口</option>
                                <option value="5">农业集体户口</option>
                                <option value="6">自理口粮户口</option>
                                <option value="7">寄住户口</option>
                                <option value="8">暂住户口</option>
                                <option value="9">地方城镇居民户口</option>
                                <option value="10">其他户口</option>
                            </select>
                            <span class="integral-td-title ml50">落户性质：</span>
                            <select name="settledNature" id="settledNature">
                                <!--<option value="0">请选择</option>-->
                                <option value="1">本单位集体户口</option>
                                <option value="2">非本单位集体户口</option>
                                <option value="3">家庭户口</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">迁入户籍登记机关：</td>
                        <td>
                            <select name="registeredOffice" id="registeredOffice">
                                <option value="0">请选择</option>
                            </select>
                            <span class="integral-td-title ml50">登记地区：</span>
                            <select name="registeredRegion" id="registeredRegion">
                                <option value="0">请选择</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">迁入地址详细地址：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="address" id="address" value="$!{houseMoveModel.address}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">证明收件人：</td>
                        <td>
                            <input class="integral-input w200" placeholder="户口准予迁入证明快递收件人" type="text" name="witness"
                                   id="witness" value="$!{houseMoveModel.witness}">
                            <span class="integral-td-title ml75">电话：</span>
                            <input class="integral-input w200" type="text" name="witnessPhone" id="witnessPhone" value="$!{houseMoveModel.witnessPhone}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">证明收件地址：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="witnessAddress" id="witnessAddress" value="$!{houseMoveModel.witnessAddress}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">拟落户地区：</td>
                        <td>
                            <select name="region" id="region">
                                <option value="21">和平区</option>
                                <option value="22">河东区</option>
                                <option value="23">河西区</option>
                                <option value="24">南开区</option>
                                <option value="25">河北区</option>
                                <option value="26">红桥区</option>
                                <option value="27">东丽区</option>
                                <option value="28">西青区</option>
                                <option value="29">津南区</option>
                                <option value="30">北辰区</option>
                                <option value="31">武清区</option>
                                <option value="32">宝坻区</option>
                                <option value="33">滨海新区</option>
                                <option value="34">宁河区</option>
                                <option value="35">静海区</option>
                                <option value="36">蓟州区</option>
                            </select>
                            <span class="integral-td-title ml50">婚姻状况：</span>
                            <select name="marriageStatus" id="marriageStatus">
                                <option value="1">已婚</option>
                                <option value="2">未婚</option>
                                <option value="3">丧偶</option>
                                <option value="4">离婚</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">有无子女</td>
                        <td>
                            <input class="input_radio" type="radio" name="haveSon" value="1" id="haveSon" #if(${houseMoveModel.haveSon} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp; <label for="haveSon">有</label>
                            <input class="input_radio ml30" type="radio" name="haveSon" value="2" id="haveNoSon" #if(${houseMoveModel.haveSon} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="haveNoSon">无</label>
                            <span class="integral-td-title ml50">子女数量：</span>
                            <input class="integral-input" type="number" placeholder="无子女数量可不填" name="sonNumber"
                                   id="sonNumber" value="$!{houseMoveModel.sonNumber}" style="width:265px;">
                        </td>
                    </tr>
                </table>
            </form>
            <!-- 上边选中子女 为有 校验下方子女表 -->
            <div id="children-table">
                <!-- table表格部分1 子女关系表 -->
                <form class="houseRelationshipsForm">
                    <table class="integral-table border-add integral-cont-table houseRelationships">
                        <tr>
                            <th width="50"></th>
                            <th>与本人关系</th>
                            <th>姓名</th>
                            <th width="281">身份证号</th>
                            <th width="100">是否随迁</th>
                            <th>文化程度</th>
                        </tr>
                        #foreach(${houseRelationship} in $!{houseRelationshipList})
                        <tr class="houseRelationship">
                            <td>
                                <input type="hidden" name="id" value="$!{houseRelationship.id}">
                                <input type="checkbox" name="check" class="checkRelation">
                            </td>
                            <td>
                                <select name="relationship">
                                    <option value="子" #if(${houseRelationship.relationship}=="子") selected #end>子</option>
                                    <option value="女" #if(${houseRelationship.relationship}=="女") selected #end>女</option>
                                    <option value="配偶" #if(${houseRelationship.relationship}=="配偶") selected #end>配偶</option>
                                </select>
                            </td>
                            <td>
                                <input class="table_add_input" type="text" name="name" value="$!{houseRelationship.name}">
                            </td>
                            <td>
                                <input class="table_add_input" type="text" name="idNumber" value="$!{houseRelationship.idNumber}">
                            </td>
                            <td><input type="radio" name="isRemove${velocityCount}" value="1" id="isRemove1${velocityCount}" #if(${houseRelationship.isRemove} == 1) checked #end>
                                <label for="isRemove1${velocityCount}">是</label>
                                <input class="m15" type="radio" name="isRemove${velocityCount}" value="2" id="isRemove2${velocityCount}" #if(${houseRelationship.isRemove} == 2) checked #end>
                                <label for="isRemove2${velocityCount}">否</label></td>
                            <td>
                                <input class="table_add_input" type="text" name="cultureDegree" value="$!{houseRelationship.cultureDegree}">
                            </td>
                        </tr>
                        #end
                    </table>
                </form>
                <!-- 子女关系表 控制按钮 -->
                <div class="integral-paging-device-wrap">
                    <!--  -->
                    <div class="interal-main-btn m15 fr mt10" id="addRelation">增加</div>
                    <div class="interal-main-btn m15 fr mt10" id="delRelation">删除</div>
                </div>
            </div>
        </div>
        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-other">其他信息</div>
        </div>
        <!-- 表单主体部分  用table实现布局 -->
        <div class="integral-cont-table-wrap">
            <form class="houseOtherForm" id="houseOtherForm">
                <input type="hidden" name="id" value="$!{houseOtherModel.id}" />

                <table class="integral-cont-table">
                    <tr>
                        <td class="color-red">申请人类型：</td>
                        <td>
                            <input class="input_radio" type="radio" name="applicantType" value="1" id="radio13" #if(${houseOtherModel.applicantType} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="radio13">企业员工</label>
                            <input class="input_radio ml30" type="radio" name="applicantType" value="2" id="radio14" #if(${houseOtherModel.applicantType} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="radio14">投资者</label>
                            <input class="input_radio ml30" type="radio" name="applicantType" value="3" id="radio15" #if(${houseOtherModel.applicantType} == 3) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="radio15">个体商户</label>
                            <input class="input_radio ml30" type="radio" name="applicantType" value="4" id="radio151" #if(${houseOtherModel.applicantType} == 4) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="radio151">事业单位</label>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">政治面貌：</td>
                        <td>
                            <select name="politicalStatus" id="politicalStatus">
                                <option value="13" selected>群众</option>
                                <option value="1">中共党员</option>
                                <option value="2">中共预备党员</option>
                                <option value="3">共青团员</option>
                                <option value="4">民革会员</option>
                                <option value="5">民盟盟员</option>
                                <option value="6">民建会员</option>
                                <option value="7">民进会员</option>
                                <option value="8">农工党党员</option>
                                <option value="9">致公党党员</option>
                                <option value="10">九三学社社员</option>
                                <option value="11">台盟盟员</option>
                                <option value="12">无党派民主人士</option>
                            </select>
                            <span class="integral-td-title ml50">军人立功：</span>
                            <select name="soldierMeritorious" id="soldierMeritorious">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">文化程度：</td>
                        <td>
                            <select name="cultureDegree" id="cultureDegree">
                            </select>
                            <span class="integral-td-title ml75">学位：</span>
                            <select name="degree" id="degree">
                                <option value="0">无</option>
                                <option value="1">博士后</option>
                                <option value="2">名誉博士</option>
                                <option value="3">博士</option>
                                <option value="4">硕士</option>
                                <option value="5">学士</option>
                                <option value="6">双学士</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">专业：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="profession" id="profession" value="$!{houseOtherModel.profession}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">现单位名称：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="companyName" value="$!{houseOtherModel.companyName}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">现单位地址：</td>
                        <td>
                            <input class="integral-input w518" type="text" name="companyAddress" value="$!{houseOtherModel.companyAddress}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">单位电话：</td>
                        <td>
                            <input class="integral-input w200" type="text" name="companyPhone" value="$!{houseOtherModel.companyPhone}">
                            <span class="integral-td-title ml50">本人电话：</span>
                            <input class="integral-input w200" type="text" name="selfPhone" value="$!{houseOtherModel.selfPhone}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">居住证申领日期：</td>
                        <td>
                            <input class="integral-input w200" type="text" name="applicationDate" id="applicationDate" value="$!{houseOtherModel.applicationDate}">
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">社保缴纳：</td>
                        <td>
                            <input class="input_radio" type="radio" name="socialSecurityPay" value="1" id="redio1" #if(${houseOtherModel.socialSecurityPay} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="redio1">是</label>
                            <input class="input_radio ml30" type="radio" name="socialSecurityPay" value="2" id="redio2" #if(${houseOtherModel.socialSecurityPay} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="redio2">否</label>
                            <span class="grey-color">是否缴纳社保</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">公积金：</td>
                        <td>
                            <input class="input_radio" type="radio" name="providentFund" value="1" id="redio3" #if(${houseOtherModel.providentFund} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="redio3">是</label>
                            <input class="input_radio ml30" type="radio" name="providentFund" value="2" id="redio4" #if(${houseOtherModel.providentFund} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="redio4">否</label>
                            <span class="grey-color">是否参加住房公积金</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">纳税情况：</td>
                        <td>
                            <input class="input_radio" type="radio" name="taxes" value="1" id="radio5" #if(${houseOtherModel.taxes} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;<label for="radio5">是</label>
                            <input class="input_radio ml30" type="radio" name="taxes" value="2" id="radio6" #if(${houseOtherModel.taxes} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio6">否</label>
                            <span class="grey-color">近3年在本市依法缴纳个人所得税累计10万元及以上</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">拘留记录：</td>
                        <td>
                            <input class="input_radio" type="radio" name="detention" value="1" id="radio7" #if(${houseOtherModel.detention} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio7">是</label>
                            <input class="input_radio ml30" type="radio" name="detention" value="2" id="radio8" #if(${houseOtherModel.detention} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio8">否</label>
                            <span class="grey-color">积分期间有无行政拘留记录</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">获刑记录：</td>
                        <td>
                            <input class="input_radio" type="radio" name="penalty" value="1" id="radio9" #if(${houseOtherModel.penalty} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio9">是</label>
                            <input class="input_radio ml30" type="radio" name="penalty" value="2" id="radio10" #if(${houseOtherModel.penalty} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio10">否</label>
                            <span class="grey-color">积分期间有无犯罪获刑记录</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="color-red">奖项荣誉称号：</td>
                        <td>
                            <select name="awardsTitle" id="awardsTitle" style="width:518px;">
                            </select>
                        </td>
                    </tr>
                </table>
            </form>
        </div>

        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-zyzg">职业资格证书</div>
        </div>
        <!-- 表单主体部分  用table实现布局 -->
        <div class="integral-cont-table-wrap">
            <form class="houseProfessionForm">
                <input type="hidden" name="id" value="$!{houseProfessionModel.id}" />
                <table class="integral-cont-table">
                    <tr>
                        <td class="color-red">职业资格项：</td>
                        <td>
                            <input class="input_radio" type="radio" name="professionType" value="1" id="radio16" #if(${addFlag}) checked #end #if(${houseProfessionModel.professionType} == 1) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio16">无</label>
                            <input class="input_radio ml30" type="radio" name="professionType" value="2" id="radio17" #if(${houseProfessionModel.professionType} == 2) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio17">具有职称</label>
                            <input class="input_radio ml30" type="radio" name="professionType" value="3" id="radio18" #if(${houseProfessionModel.professionType} == 3) checked #end>
                            &nbsp;&nbsp;&nbsp;
                            <label for="radio18">具有职业资格</label>
                        </td>
                    </tr>
                    <tr class="professionType_2">
                        <td class="color-red">职称级别：</td>
                        <td>
                            <select name="jobTitleLevel" id="jobTitleLevel">
                                <option value="1">初级职称</option>
                                <option value="2">中级职称</option>
                                <option value="3">高级职称</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="professionType_2 color-red">
                        <td>职位：</td>
                        <td>
                            <input class="integral-input w200" type="text" name="jobPosition" id="jobPosition" value="$!{houseProfessionModel.jobPosition}">
                            <span class="integral-td-title ml50">发证机关：</span>
                            <input class="integral-input w200" type="text" name="issuingAuthority" id="issuingAuthority" value="$!{houseProfessionModel.issuingAuthority}">
                        </td>
                    </tr>
                    <tr class="professionType_2 color-red">
                        <td>发证日期：</td>
                        <td>
                            <input class="integral-input w200" type="text" name="issuingDate" id="issuingDate" value="$!{houseProfessionModel.issuingDate}">
                            <span class="integral-td-title ml50">证书编号：</span>
                            <input class="integral-input w200" type="text" name="certificateCode" id="certificateCode" value="$!{houseProfessionModel.certificateCode}">
                        </td>
                    </tr>
                    <tr class="professionType_3 color-red">
                        <td>职业资格级别：</td>
                        <td>
                            <select name="jobLevel" id="jobLevel">
                            </select>
                        </td>
                    </tr>
                    <tr class="professionType_3 color-red">
                        <td>工种：</td>
                        <td>
                            <select name="jobType" id="jobType">
                            </select>
                        </td>
                    </tr>

                </table>
            </form>
        </div>

        <!-- 验证码和底部按钮 -->
        <table class="check-table">
            <tr>
                <td>
                    <span class="color-red">*</span>验证码：
                </td>
                <td>
                    <input class="integral-input w200" type="text" name="captcha">
                    <div class="checkimg">
                        <img id="captchaImg" src="${rc.contextPath}/captcha.jpg" alt="看不清点我" class="click_me">
                    </div>
                    <span class="click_me">看不清点我</span>
                </td>
            </tr>
        </table>
        <!-- 保存按钮 -->
        <div class="integral-bottom-btn-group">
            <div class="interal-main-btn big-btn m15" id="submitAndContinue">保存并继续录入</div>
            <div class="interal-main-btn big-btn ml50" id="submit">保存</div>
            <div class="interal-main-btn big-btn ml50" id="cancel">返回</div>
        </div>
    </div>
</div>

<!-- 底部栏 footer -->
#parse("common/footer.html")
</body>
<script type="text/javascript" src="${rc.contextPath}/$static.curr_ver()/js/jquery.form.min.js"></script>
<script type="text/javascript">
    var relation_idx = $("tr.houseRelationship").length+1;

    $(function () {

        currPage("addIdentity");

        laydate.render({
            elem: '#birthday' //生日
            ,max: 0,
            change: function(value, date, endDate) {
                var date = new Date();
                var startDate = new Date(value);
                var newDate = date.getTime() - startDate.getTime();
                var age = Math.ceil(newDate / 1000 / 60 / 60 / 24 /365);
                if (isNaN(age)){
                    age = 0;
                }
                $("#age").val(age);
            }
        });

        laydate.render({
            elem: '#issuingDate' //发证日期
            ,max: 0
        });

        laydate.render({
            elem: '#applicationDate' //居住证申领日期
            ,max: 0
        });

        //获取评分选项信息
        getResultData("${rc.contextPath}/indicator/getAllIndicators", {}, function(data){
            //1.年龄,2.受教育程度,3.专业技术、职业技能水平,4.社会保险,5.住房公积金,6.住房,7.在津连续居住年限,
            //8.职业（工种）,9.落户地区,10.纳税,11.婚姻情况,12.知识产权,13.奖项和荣誉称号,14.退役军人,15.守法诚信
            initIndicatorInfo(data["2"], $("#cultureDegree"), '$!{houseOtherModel.cultureDegree}');

            initIndicatorInfo(data["3"], $("#jobLevel"), '$!{houseProfessionModel.jobLevel}');

            initIndicatorInfo(data["8"], $("#jobType"), '$!{houseProfessionModel.jobType}');

            initIndicatorInfo(data["13"], $("#awardsTitle"), '$!{houseOtherModel.awardsTitle}');

            initIndicatorInfo(data["14"], $("#soldierMeritorious"), '$!{houseOtherModel.soldierMeritorious}');
        });

        //初始化省份信息
        regionChange(0, "moveProvince", '$!{houseMoveModel.moveProvince}');

        $("#moveProvince").on("change",
            function () {
                regionChange($("#moveProvince").val(), "moveCity", '$!{houseMoveModel.moveCity}');
            }
        ).change();
        $("#moveCity").on("change",
            function () {
                regionChange($("#moveCity").val(), "moveRegion", '$!{houseMoveModel.moveRegion}');
            }
        ).change();

        //添加户籍关系
        $("#addRelation").on("click",
            function () {
                var html = [];
                html.push('<tr class="houseRelationship">');
                html.push('<td><input type="checkbox" name="check" class="checkRelation"></td>');
                html.push('<td>');
                var relationshipOption = '<option value="子">子</option><option value="女">女</option><option value="配偶">配偶</option>';
                if($("#marriageStatus").val() == 2) {
                    relationshipOption = '<option value="子">子</option><option value="女">女</option>';
                }
                html.push('<select name="relationship">'+relationshipOption+'</select>');
                html.push('</td>');
                html.push('<td><input class="table_add_input" type="text" name="name"></td>');
                html.push('<td><input class="table_add_input" type="text" name="idNumber"></td>');
                html.push('<td><input type="radio" name="isRemove' + relation_idx + '" value="1" id="isRemove1' + relation_idx + '_yes"><label for="isRemove1' + relation_idx + '_yes">是</label>');
                html.push('<input class="m15" type="radio" name="isRemove' + relation_idx + '" value="2" id="isRemove2' + relation_idx + '_no"><label for="isRemove2' + relation_idx + '_no">否</label></td>');
                html.push('<td><input class="table_add_input" type="text" name="cultureDegree"></td>');
                html.push('</tr>');
                $(".houseRelationships").append(html.join(''));

                relation_idx = relation_idx + 1;
            }
        );

        $("#delRelation").on("click",
            function () {
                $(".checkRelation:checked").each(function () {
                    $(this).parents("tr").remove();
                });
            }
        );

        //提交
        $("#submit").on("click", submit);
        $("#submitAndContinue").on("click", submitAndContinue);

        //身份证正面上传
        $("input[name=idcard1]").on("change", function () {
            var form = $("<form>");
            form.attr('style', 'display:none');
            form.attr('method', 'post');
            form.attr('action', '${rc.contextPath}/fileUpload/uploadImage');
            form.attr('enctype', 'multipart/form-data');
            var file = $("input[name=idcard1]").clone();
            $(file).attr('name', 'file');
            $(form).append(file);

            $('body').append(form);

            $(form).ajaxSubmit(function (result) {
                var obj = JSON.parse(result);
                if (!obj.code) {
                    $("input[name=id_card_positive]").val(obj.data.attachmentUrl);
                } else {
                    layer.msg(obj.msg);
                }
            });
        });

        //身份证反面上传
        $("input[name=idcard2]").on("change", function () {
            var form = $("<form>");
            form.attr('style', 'display:none');
            form.attr('method', 'post');
            form.attr('action', '${rc.contextPath}/fileUpload/uploadImage');
            form.attr('enctype', 'multipart/form-data');
            var file = $("input[name=idcard2]").clone();
            $(file).attr('name', 'file');
            $(form).append(file);

            $('body').append(form);
            $(form).ajaxSubmit(function (result) {
                var obj = JSON.parse(result);
                if (!obj.code) {
                    $("input[name=id_card_opposite]").val(obj.data.attachmentUrl);
                } else {
                    layer.msg(obj.msg);
                }
            });
        });

        //初始化迁入户籍登记机关
        initOfficeInfo(0, $("#registeredOffice"), '$!{houseMoveModel.registeredOffice}');

        $("#registeredOffice").on("change", function () {
            initOfficeInfo($(this).val(), $("#registeredRegion"), '$!{houseMoveModel.registeredRegion}');
        }).change();

        $("#marriageStatus").on("change", function() {
            if($(this).val() == 2) {
                $("select[name=relationship]").each(function(){
                    if($(this).val() == '配偶') {
                        $(this).val('子');
                    }

                    $(this).find("option[value=配偶]").remove();
                });
            } else {
                $("select[name=relationship]").each(function(){
                    if($(this).find("option[value=配偶]").length == 0) {
                        $(this).append('<option value="配偶">配偶</option>');
                    }
                });
            }
        });

        //职业资格项
        $("input[name=professionType]").on("change", function(){
            var professionType = $('input:radio[name="professionType"]:checked').val();
            if(professionType == 1) {//无
                $("tr.professionType_2").hide();
                $("tr.professionType_3").hide();
            } else if(professionType == 2) {//具有职称
                $("tr.professionType_2").show();
                $("tr.professionType_3").hide();
            } else if(professionType == 3) {//具有职业资格
                $("tr.professionType_2").hide();
                $("tr.professionType_3").show();
            }
        }).change();

        $("input[name=haveSon]").on("change", function(){
            var haveSon = $('input:radio[name="haveSon"]:checked').val();
            if(haveSon == 1) {
                $("#sonNumber").removeAttr("disabled");
            } else if(haveSon == 2) {
                $("#sonNumber").attr("disabled", "disabled");
                $("#sonNumber").val('0');
            }
        }).change();

        //验证身份证号信息
        $("#idNumber").on("blur", function(){
            if($.trim($(this).val()) == '') {
                return false;
            }
            postResultData("${rc.contextPath}/identityInfo/validIdNumber", {"idNumber":$(this).val(), "identityInfoId": $("#identityInfoId").val()}, function(data){
                if(data.validFlag == false) {
                    layer.msg('每期身份必须唯一, 请修改身份证信息!!');
                }
            });
        });


        //验证表单信息
        registerValidateForm();

        if('${addFlag}' == 'false') {
            initIdentityInfo();
        }
    });

    /**
     * 提交表单
     */
    function submit() {
        var formInfo = getFormInfo();
        if(formInfo == false) {
            return false;
        }

        var url = "${rc.contextPath}/identityInfo/addIdentityInfo";
        if('${addFlag}' == 'false') {
            url = "${rc.contextPath}/identityInfo/updateIdentityInfo";
        }

        var flag = false;
        postSyncResultData(url, formInfo, function(data){
            layer.msg('保存成功!!', {
                time: 1000
            }, function () {
                flag = true;
            });
        });

        if(flag) {
            if(window.opener && window.opener.component) {
                window.opener.component.load();
                window.close();
            } else {
                window.close();
            }
        }
    }

    /**
     * 提交并继续录入
     */
    function submitAndContinue() {
        var formInfo = getFormInfo();
        if(formInfo == false) {
            return false;
        }

        var url = "${rc.contextPath}/identityInfo/addIdentityInfo";
        if('${addFlag}' == 'false') {
            url = "${rc.contextPath}/identityInfo/updateIdentityInfo";
        }

        var flag = false;
        postSyncResultData(url, formInfo, function(data){
            layer.msg('保存成功!!', {
                time: 1000
            }, function () {
                flag = true;
            });
        });

        if(flag) {
            window.open("${rc.contextPath}/identityInfo/applicationAdd.html");

            if(window.opener && window.opener.component) {
                window.opener.component.load();
                window.close();
            } else {
                //history.go(-1);
                window.close();
            }
        }
    }

    /**
     * 获取表单信息
     */
    function getFormInfo() {
        var validateFlag = true;
        if(!$("#identityInfoForm").valid()) {
            validateFlag = false;
        }

        if(!$("#houseMoveForm").valid()) {
            validateFlag = false;
        }

        if(!$("#houseOtherForm").valid()) {
            validateFlag = false;
        }

        $(".houseRelationship").each(function () {
            var relationship = $(this).find("select[name=relationship]").val();
            var name = $(this).find("input[name=name]").val();
            var idNumber = $(this).find("input[name=idNumber]").val();
            var isRemove = $(this).find("input[type=radio]:checked").val();
            var cultureDegree = $(this).find("input[name=cultureDegree]").val();

            if($.trim(name) == '') {
                layer.msg("请填写姓名。");
                $(this).find("input[name=name]").focus();
                validateFlag = false;
                return false;
            }

            var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
            if(!pattern.test(idNumber)) {
                layer.msg("身份证格式不正确。");
                $(this).find("input[name=idNumber]").focus();
                validateFlag = false;
                return false;
            }

            debugger;
            if(!isRemove) {
                layer.msg("请填写是否随迁。");
                $(this).find("input[name=isRemove]").focus();
                validateFlag = false;
                return false;
            }

            if($.trim(cultureDegree) == '') {
                layer.msg("请填写文化程度。");
                $(this).find("input[name=cultureDegree]").focus();
                validateFlag = false;
                return false;
            }
        });

        if(!validateFlag) {
            return false;
        }

        //验证职业资格证书信息
        var professionType = $('input:radio[name="professionType"]:checked').val();
        if(professionType == 2) {
            if($.trim($("#jobPosition").val()) == '' || $.trim($("#issuingAuthority").val()) == '' || $.trim($("#issuingDate").val()) == '' || $.trim($("#certificateCode").val()) == '') {
                layer.msg("请将职称信息填写完整");
                validateFlag = false;
            }
        }

        if(!validateFlag) {
            return false;
        }

        var identityInfo = serializeForm($(".identityInfoForm"));
        var houseMoveInfo = serializeForm($(".houseMoveForm"));

        var houseRelationshipInfos = [];
        //初始化家庭关系信息
        $(".houseRelationship").each(function () {
            var id = $(this).find("input[name=id]").val();
            var relationship = $(this).find("select[name=relationship]").val();
            var name = $(this).find("input[name=name]").val();
            var idNumber = $(this).find("input[name=idNumber]").val();
            var isRemove = $(this).find("input[type=radio]:checked").val();
            var cultureDegree = $(this).find("input[name=cultureDegree]").val();

            var houseRelationship = {
                "id": id,
                "relationship": relationship,
                "name": name,
                "idNumber": idNumber,
                "isRemove": isRemove,
                "cultureDegree": cultureDegree
            };
            houseRelationshipInfos.push(houseRelationship);
        });

        var houseOtherInfo = serializeForm($(".houseOtherForm"));
        var houseProfessionInfo = serializeForm($(".houseProfessionForm"));

        identityInfo["houseMoveModel"] = houseMoveInfo;
        identityInfo["houseRelationshipModelList"] = houseRelationshipInfos;
        identityInfo["houseOtherModel"] = houseOtherInfo;
        identityInfo["houseProfessionModel"] = houseProfessionInfo;

        var captcha = $("input[name=captcha]").val();

        var identityInfoJson = JSON.stringify(identityInfo);

        var formData = {"identityInfoJson": identityInfoJson, "captcha": captcha};

        return formData;
    }

    /**
     * 省市区变更
     *
     * @param regionId
     */
    function regionChange(regionId, changeRegion, defaultVal) {
        if (regionId == 0 && changeRegion != "moveProvince") {
            return;
        }

        if (changeRegion == "moveCity") {
            $("#moveRegion").html('<option value="0">请选择</option>');
        }

        getSyncResultData("${rc.contextPath}/region/child/regions/" + regionId, {}, function(data){
            var html = [];
            html.push('<option value="0">请选择</option>');
            if (data != undefined) {
                for (var i = 0; i < data.length; i++) {
                    var selected = '';
                    if(defaultVal != '' && defaultVal == data[i].id) {
                        selected = 'selected';
                    }
                    html.push('<option value="' + data[i].id + '" '+ selected +'>' + data[i].name + '</option>');
                }
            }
            $("#" + changeRegion).html(html.join(''));
        });

    }

    /**
     * 初始化评分选项信息
     */
    function initIndicatorInfo(indicatorInfo, field, defaultVal) {
        if(indicatorInfo == undefined) {
            field.html('');
        }
        var indicatorItems = indicatorInfo.indicatorItems;

        if(indicatorItems == undefined || indicatorItems.length == 0) {
            field.html('');
        }
        var arr = new Array();
        for(var i=0; i<indicatorItems.length; i++) {
            var selected = '';
            if(defaultVal == '' && indicatorItems[i].content == '无') {
                selected = " selected ";
            } else if(defaultVal != '' && indicatorItems[i].id == defaultVal){
                selected = " selected ";
            }

            arr.push('<option value="'+ indicatorItems[i].id +'" ' + selected + '>'+ indicatorItems[i].content +'</option>');
        }

        field.html(arr.join(''));
    }

    /**
     * 初始化迁入登记机关
     *
     */
    function initOfficeInfo(officeId, field, defaultVal) {
        getSyncResultData("${rc.contextPath}/office/getOffices", {"parentId": officeId}, function (data) {
            var offices = data;
            var officeArr = new Array();
            for (var i = 0; i < offices.length; i++) {
                var office = offices[i];
                var selected = '';
                if(defaultVal != '' && defaultVal == office["id"]) {
                    selected = 'selected';
                }
                officeArr.push('<option value="' + office["id"] + '" '+ selected +'>' + office["name"] + '</option>');
            }
            field.html(officeArr.join(''));
        });
    }

    //验证表单信息
    function registerValidateForm() {
        //身份证信息验证
        $("#identityInfoForm").validate({
            rules: {
                idNumber: {
                    required: true,
                    isIdCardNo: true
                },
                name: {
                    required: true,
                    maxlength: 20
                },
                sex: {
                    required: true
                },
                birthday: {
                    required: true
                },
                age: {
                    required: true,
                    isAge: true
                },
                nation: {
                    required: true,
                    maxlength: 50
                }
            },
            messages: {
                idNumber: {
                    required: "请输入身份证号"
                },
                name: {
                    required: "请输入姓名",
                    maxlength: "姓名长度不能大于 20 个字母"
                },
                sex: {
                    required: "请输入性别"
                },
                birthday: {
                    required: "请输入出生日期"
                },
                age: {
                    required: "请输入年龄"
                },
                nation: {
                    required: "请输入民族",
                    maxlength: "民族长度不能大于 50 个字母"
                }
            },

            errorPlacement: function (error, element) { //指定错误信息位置
                if (element.is(':radio') || element.is(':checkbox')) { //如果是radio或checkbox
                    var eid = element.attr('name'); //获取元素的name属性
                    error.appendTo(element.parent()); //将错误信息添加当前元素的父结点后面
                } else {
                    error.insertAfter(element);
                }
            }
        });

        $("#houseMoveForm").validate({
            rules: {
                moveRegion: {
                    required: true
                },
                moveAddress: {
                    required: true,
                    maxlength: 100
                },
                moveRegisteredOffice: {
                    required: true,
                    maxlength: 100
                },
                houseNature: {
                    required: true
                },
                settledNature: {
                    required: true
                },
                registeredRegion: {
                    required: true
                },
                address: {
                    required: true,
                    maxlength: 100
                },
                witness: {
                    required: true,
                    maxlength: 50
                },
                witnessPhone: {
                    required: true,
                    isPhone: true
                },
                witnessAddress: {
                    required: true,
                    maxlength: 100
                },
                region: {
                    required: true
                },
                marriageStatus: {
                    required: true
                },
                haveSon: {
                    required: true
                }
            },
            messages: {
                moveRegion: {
                    required: "请输入迁出地区"
                },
                moveAddress: {
                    required: "请输入迁出地地址",
                    maxlength: "姓名长度不能大于 100 个字母"
                },
                moveRegisteredOffice: {
                    required: "请输入现户籍登记机关",
                    maxlength: "现户籍登记机关长度不能大于 100 个字母"
                },
                houseNature: {
                    required: "请输入现户口性质"
                },
                settledNature: {
                    required: "请输入落户性质"
                },
                registeredRegion: {
                    required: "请输入迁入户籍登记机关"
                },
                address: {
                    required: "请输入迁入地址详细地址",
                    maxlength: "姓名长度不能大于 100 个字母"
                },
                witness: {
                    required: "请输入证明收件人",
                    maxlength: "姓名长度不能大于 50 个字母"
                },
                witnessPhone: {
                    required: "请输入证明收件人电话"
                },
                witnessAddress: {
                    required: "请输入证明收件地址",
                    maxlength: "姓名长度不能大于 100 个字母"
                },
                region: {
                    required: "请输入拟落户地区"
                },
                marriageStatus: {
                    required: "请输入婚姻状况"
                },
                haveSon: {
                    required: "请输入有无子女"
                }
            },

            errorPlacement: function (error, element) { //指定错误信息位置
                if (element.is(':radio') || element.is(':checkbox')) { //如果是radio或checkbox
                    var eid = element.attr('name'); //获取元素的name属性
                    error.appendTo(element.parent()); //将错误信息添加当前元素的父结点后面
                } else {
                    error.insertAfter(element);
                }
            }
        });

        //其他信息验证
        $("#houseOtherForm").validate({
            rules: {
                applicantType: {
                    required: true
                },
                politicalStatus: {
                    required: true
                },
                soldierMeritorious: {
                    required: true
                },
                cultureDegree: {
                    required: true
                },
                degree: {
                    required: true
                },
                profession: {
                    required: true,
                    maxlength: 50
                },
                companyName: {
                    required: true,
                    maxlength: 100
                },
                companyAddress: {
                    required: true,
                    maxlength: 100
                },
                companyPhone: {
                    required: true,
                    isPhone: true
                },
                selfPhone: {
                    required: true,
                    isPhone: true
                },
                applicationDate: {
                    required: true
                },
                socialSecurityPay: {
                    required: true
                },
                providentFund: {
                    required: true
                },
                taxes: {
                    required: true
                },
                detention: {
                    required: true
                },
                penalty: {
                    required: true
                },
                awardsTitle: {
                    required: true
                }
            },
            messages: {
                applicantType: {
                    required: "请输入申请人类型"
                },
                politicalStatus: {
                    required: "请输入政治面貌"
                },
                soldierMeritorious: {
                    required: "请输入军人立功"
                },
                cultureDegree: {
                    required: "请输入文化程度"
                },
                degree: {
                    required: "请输入学位"
                },
                profession: {
                    required: "请输入专业",
                    maxlength: 50
                },
                companyName: {
                    required: "请输入现单位名称",
                    maxlength: 100
                },
                companyAddress: {
                    required: "请输入现单位地址",
                    maxlength: 100
                },
                companyPhone: {
                    required: "请输入单位电话"
                },
                selfPhone: {
                    required: "请输入本人电话"
                },
                applicationDate: {
                    required: "请输入居住证申领日期"
                },
                socialSecurityPay: {
                    required: "请输入社保缴纳"
                },
                providentFund: {
                    required: "请输入公积金"
                },
                taxes: {
                    required: "请输入纳税情况"
                },
                detention: {
                    required: "请输入拘留记录"
                },
                penalty: {
                    required: "请输入获刑记录"
                },
                awardsTitle: {
                    required: "请输入奖项荣誉称号"
                }
            },

            errorPlacement: function (error, element) { //指定错误信息位置
                if (element.is(':radio') || element.is(':checkbox')) { //如果是radio或checkbox
                    var eid = element.attr('name'); //获取元素的name属性
                    error.appendTo(element.parent()); //将错误信息添加当前元素的父结点后面
                } else {
                    error.insertAfter(element);
                }
            }
        });
    }

    //初始化申请人信息
    function initIdentityInfo() {
        //户籍迁移信息
        $("#houseNature").val('${houseMoveModel.houseNature}');
        $("#settledNature").val('${houseMoveModel.settledNature}');
        $("#region").val('${houseMoveModel.region}');
        $("#marriageStatus").val('${houseMoveModel.marriageStatus}');

        //其他信息
        $("#politicalStatus").val('${houseOtherModel.politicalStatus}');
        $("#degree").val('${houseOtherModel.degree}');


        //职业资格证书
        $("#jobTitleLevel").val('${houseProfessionModel.jobTitleLevel}');
    }

</script>

</html>

