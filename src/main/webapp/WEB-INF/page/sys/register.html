<!DOCTYPE html>
<html lang="cn">

<title>用户注册</title>
#parse("common/header.html")
</head>

<body>
<!-- banner和title部分 -->
#parse("common/banner.html")

<!-- 主体部分 -->
<div class="integral-main-box">
    <!--需要显示转圈圈直接调用 showLoading(true);取消转圈圈直接调用showLoading(false);-->
    <div id="foo" style="width: 100%; height: 100%"></div>

    <!-- 内容展示区  登录和注册等不带导航模块需要加 样式 ”cont-center“-->
    <div class="integral-cont ml105">
        <!-- 网上注册 -->
        <!-- 示例title 面包屑导航 -->
        <div class="integral-grey-title-bar">
            <div class="title-bar-head title-bar-yhzc">用户注册</div>
        </div>
        <!-- 内容描述title -->
        <div class="integral-desc-title">
            网上注册
        </div>
        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-wszc">网上注册信息</div>
        </div>
        <form id="companyForm">
            <!-- 用户注册表格 -->
            <div class="integral-cont-table-wrap">
                <table class="integral-cont-table">
                    <tr>
                        <td></td>
                        <td class="color-red" style="line-height: 20px;padding-left:45px;">
                            <span>提示：1、请在电脑上操作，不要在手机上操作。</span><br/>
                            <span style="padding-left:42px;">2、推荐使用Google Chrome（谷歌）、IE9+浏览器，IE版本过低的请升级9以上</span><br/>
                            <span style="padding-left:42px;">3、统一社会信用代码为用户名</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>统一社会信用代码：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="userName" name="userName"
                                   placeholder="请输入统一社会信用代码" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="password" name="password"
                                   placeholder="请使用8--20位" type="password">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>确认密码：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="passwordConfirm" name="passwordConfirm"
                                   placeholder="请再输入一遍您上面填写的密码" type="password">
                        </td>
                    </tr>
                </table>
            </div>
            <!-- 示例title2 二级标题 -->
            <div class="integral-grey-title-bar title-bar2">
                <div class="title-bar-head title-bar-dwjb">申请单位基本信息</div>
            </div>
            <!-- 事业单位基本信息表格 -->
            <div class="integral-cont-table-wrap">
                <table class="integral-cont-table">

                    <tr>
                        <td>
                            <span class="color-red">*</span>单位名称：
                        </td>
                        <td>
                            <input class="integral-input w450" id="companyName" name="companyName"
                                   placeholder="单位名称必须与营业执照一致" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <span class="color-red" style="padding-bottom: 20px;line-height:20px;">提示：单位名称与统一社会信用代码保存成功后不可更改</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>单位类型：
                        </td>
                        <td>
                            <input class="input_radio" type="radio" name="companyType" value="1" id="shiyedanwei">&nbsp;&nbsp;&nbsp;
                            <label for="shiyedanwei">机关、事业单位</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="2" id="guoyouqiye">&nbsp;&nbsp;&nbsp;
                            <label for="guoyouqiye">国有企业</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="3" id="waizihezi">&nbsp;&nbsp;&nbsp;
                            <label for="waizihezi">外资、合资企业</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="4" id="siyingqiye">&nbsp;&nbsp;&nbsp;
                            <label for="siyingqiye">私营企业</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="5" id="zhongyang">&nbsp;&nbsp;&nbsp;
                            <label for="zhongyang">央企和中央驻津单位</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="6" id="getigongshanghu">&nbsp;&nbsp;&nbsp;
                            <label for="getigongshanghu">个体工商户</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="7" id="minbanfeiqiye">&nbsp;&nbsp;&nbsp;
                            <label for="minbanfeiqiye">民办非企业</label><br>
                            <input class="input_radio" type="radio" name="companyType" value="8" id="qita">&nbsp;&nbsp;&nbsp;
                            <label for="qita">其他</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>单位联系电话：
                        </td>
                        <td>
                            <input class="integral-input w450" id="companyMobile" name="companyMobile"
                                   placeholder="请输入11位手机号" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>实际经营地址：
                        </td>
                        <td>
                            <input class="integral-input w450" placeholder="申请单位实际生产经营的固定地点" id="operatorAddress"
                                   name="operatorAddress" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style="line-height:20px;padding-bottom: 20px;">
                        <span class="color-red">提示：请如实填写此项信息，违反人社局【2018】3号文件第十四条、第十六条相关规定的，将依法依规处理。。
                        </span>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operator" name="operator" placeholder="如：张三"
                                   type="text">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style="line-height:20px;padding-bottom:20px;">
                        <span class="color-red">提示：申报单位经办人与申请人社会保险缴费应为同一单位；
                        </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人身份证号：
                        </td>
                        <td>
                            <input class="integral-input w450" id="idCardNumber_1" name="idCardNumber_1"
                                   placeholder="请输入身份证号" type="text">
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人联系手机：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operatorMobile" name="operatorMobile"
                                   placeholder="请输入11位手机号码" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style="line-height:20px;padding-bottom:20px;">
                        <span class="color-red">提示：经办人联系手机号码为找回密码所用手机号码，请谨慎填写。
                        </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人身份证原件头像面
                        </td>
                        <td>
                            <div class="integral-businesslicense-img">
                                <img class="addImg pointer"
                                     src="${rc.contextPath}/$static.curr_ver()/img/IDcard1.png"
                                     onclick="integral.clickImg(this);">
                                <img class="preview" id="preview" alt="" name="pic" width="152" height="100"
                                     style="display: none"/>
                                <input id="business_license" name="business_license" type="file"
                                       class="upload_input" accept="image/*"
                                       onchange="changeImg(this)" attr-inp="businessLicenseSrc"/>
                                <div class="pointer title_click" onclick="integral.clickImg(this);" style="font-size: 10px;">
                                    点击上传身份证原件头像面
                                </div>
                                <div class="title_idcard" style="display:none;">经办人身份证原件</div>
                                <div class="del_idcard" onclick="integral.deleteImg(this)"
                                     style="display:none;"></div>
                                <input id="businessLicenseSrc" name="businessLicenseSrc"
                                       type="hidden" value=""/>
                            </div>
                            <div style="float: left;padding-top: 30px;">
                                <!-- 2019年7月16日 添加提示 -->
                                <div class="color-red" style="font-size: 13px;padding: 5px 5px 5px 5px;line-height: 20px">
                                    上传经办人身份证原件提示：
                                    <br>1、身份证原件（彩色原件）；
                                    <br>2、图片大小规定要求（图片不超过3M，jpg、png格式，长宽不超过2000像素）；
                                    <br>3、经办人填写信息与上传照片信息一致；
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人身份证原件国徽面<br/>
                        </td>
                        <td>
                            <div class="integral-businesslicense-img">
                                <img class="addImg pointer"
                                     src="${rc.contextPath}/$static.curr_ver()/img/IDcard2.png"
                                     onclick="integral.clickImg(this);">
                                <img class="preview" id="back" alt="" name="pic" width="152" height="100"
                                     style="display: none"/>
                                <input id="business_license2" name="business_license" type="file"
                                       class="upload_input" accept="image/*"
                                       onchange="changeImg(this)" attr-inp="operator2"/>
                                <div class="pointer title_click" onclick="integral.clickImg(this);"  style="font-size: 10px;">
                                    点击上传身份证原件国徽面
                                </div>
                                <div class="title_idcard" style="display:none;" >经办人身份证原件国徽面</div>
                                <div class="del_idcard" onclick="integral.deleteImg(this)"
                                     style="display:none;"></div>
                                <input id="operator2" name="operator2"
                                       type="hidden" value=""/>
                            </div>
                            <div style="float: left;padding-top: 30px;">
                                <!-- 2019年7月16日 添加提示 -->
                                <div class="color-red" style="font-size: 13px;padding: 5px 5px 5px 5px;line-height: 20px">
                                    上传经办人身份证原件提示：
                                    <br>1、身份证原件（彩色原件）；
                                    <br>2、图片大小规定要求（图片不超过3M，jpg、png格式，长宽不超过2000像素）；
                                    <br>3、经办人填写信息与上传照片信息一致；
                                </div>
                            </div>
                        </td>
                    </tr>
                    <!-- 2019年12月23日
                    添加“申请人预约地点”：
                        1、市级行政许可中心；
                        2、滨海新区行政许可中心；-->
                    <tr>
                        <td>
                            <span class="color-red">*</span>本单位申请人受理点：
                        </td>
                        <td>
                            <input class="input_radio" type="radio" name="operatorMobile2" value="1" id="shiji">&nbsp;&nbsp;&nbsp;
                            <label for="shiji">天津市政务服务中心</label>
                            <input class="input_radio ml30" type="radio" name="operatorMobile2" value="2"
                                   id="binhai">&nbsp;&nbsp;&nbsp;
                            <label for="binhai">滨海新区政务服务中心</label>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style="line-height:20px;padding-bottom:20px;">
                        <span class="color-red">提示：1、请根据实际情况选择受理点；
                            <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2、每个单位只能选择一个受理点，同一单位的全部申请人都按照此选择进行审核；
                        </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>验证码：
                        </td>
                        <td>
                            <input class="integral-input w200" type="text" id="captcha" name="captcha">
                            <div class="checkimg"><img id="captchaImg" src="${rc.contextPath}/captcha.jpg" alt="看不清点我"
                                                       class="click_me"></div>
                            <span class="click_me">看不清点我</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div class="color-red" style="line-height: 20px;padding-top:30px;">
                                *注：标有红色 * 为必填项<br>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </form>

        <!-- 登录按钮 -->
        <div class="integral-bottom-btn-group mt150">
            <div class="interal-main-btn big-btn m15" id="register">注册</div>
            <div class="interal-main-btn big-btn interal-main-btn2 ml50" id="cancel">返回</div>
        </div>
    </div>
</div>

<!-- 底部栏 footer -->
#parse("common/footer.html")
</body>
<script type="text/javascript">

    //点击注册按钮
    //    $("#register").on("click", function(){
    //        $("#companyForm").submit();
    //    });

    //点击注册按钮，2018年7月18日，添加提示
    $("#register").on("click", function () {
//        var unisci = "91120101572337651";
//        var uniFlag = checkSocialCreditCode(unisci);
//        console.log("真假："+uniFlag);
        if ($('#userName').val().indexOf(" ") !== -1) {
            layer.alert("统一社会信用代码中不能有空格！");
        } else if ($('#businessLicenseSrc').val().trim() == "") {
            layer.alert("请上传经办人身份证正反面！");
        } else {
            var index = layer.confirm('一旦注册成功，本期不可修改，确定要注册吗？', {
                btn: ['确认', '取消']
            }, function () {
                $("#companyForm").submit();
                layer.close(index);
            }, function () {
                layer.close(index);
            });
        }
    });


    $("#submitAndContinue").on("click", function () {
        //询问框
        var index = layer.confirm('确定要保存并继续录入申请人吗？', {
            btn: ['确认', '取消'] //按钮
        }, function () {
            submitAndContinue();
            layer.close(index);
        }, function () {
            layer.close(index);
        });
    });

    $(function () {

        // 自定义校验规则
        $.validator.addMethod("passwordCheck",function(value, element){
            var returnVal = false;
            //var chrnum = /^[0-9]*$/;
            var chrnum = /^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(.{8,})$/;
            return this.optional(element) || (chrnum.test(value));
        },"必须填入小写字母、大写字母、数字");

        $("#companyForm").validate({
            rules: {
                userName: {
                    required: true,
                    minlength: 10,
                    maxlength: 20
                },
                password: {
                    required: true,
                    passwordCheck:true,
                    minlength: 8,
                    maxlength: 20
                },
                passwordConfirm: {
                    required: true,
                    minlength: 8,
                    equalTo: "#password"
                },
                companyName: {
                    required: true,
                    maxlength: 100
                },
                companyMobile: {
                    required: true,
                    isMobile: true
                },
                operator: {
                    required: true,
                    maxlength: 10
                },
                operator2: {
                    required: true,
                    maxlength: 10
                },
                operatorMobile: {
                    required: true,
                    isMobile: true
                },
                operatorMobile2: {
                    required: true
//                    isMobile: true
                },
                idCardNumber_1: {
                    required: true,
                    isIdCardNo: true
                },
                idCardNumber_2: {
                    required: true,
                    isIdCardNo: true
                },
                operatorAddress: {
                    required: true,
                    maxlength: 100
                }
            },
            messages: {
                userName: {
                    required: "请输入统一社会信用代码",
                    minlength: "统一社会信用代码最少由 10 个字母组成",
                    maxlength: "统一社会信用代码最多由 20 个字母组成"
                },
                password: {
                    required: "请输入密码",
                    minlength: "用户名最少由 8 个字母数字组成",
                    maxlength: "用户名最多由 20 个字母数字组成"
                },
                passwordConfirm: {
                    required: "请输入密码",
                    minlength: "密码长度不能小于 8 个字母",
                    equalTo: "两次密码输入不一致"
                },
                companyName: {
                    required: "请输入单位名称",
                    maxlength: "单位名称不能大于 100 个字母"
                },
                companyMobile: {
                    required: "请输入单位联系电话"
                },
                operator: {
                    required: "经办人的社保缴纳单位与申请人一致",
                    maxlength: "密码长度不能大于 10 个字母"
                },
                operator2: {
                    required: "经办人的社保缴纳单位与申请人一致",
                    maxlength: "密码长度不能大于 10 个字母"
                },
                operatorMobile: {
                    required: "请输入联系手机"
                },
                operatorMobile2: {
                    required: "请选择申请人预约地点"
                },
                idCardNumber_1: {
                    required: "请输入身份证号"
                },
                idCardNumber_2: {
                    required: "请输入身份证号"
                },
                operatorAddress: {
                    required: "请输入联系地址",
                    maxlength: "密码长度不能大于 100 个字母"
                }
            },

            submitHandler: function (form) {
                var companyInfo = serializeForm($("#companyForm"));
                var captcha = companyInfo['captcha'];
                //移除元素
                delete companyInfo['passwordConfirm'];
                delete companyInfo['captcha'];

                var societyCode = $("input[name=userName]").val(); // 2019年12月23日，因根据需求将统一社会信用代码改为用户名，这里用来验证用户名（uniscid）是否合规
                if (!checkSocialCreditCode(societyCode)) {
                    return false;
                }

                // 需要显示转圈圈直接调用 showLoading(true);取消转圈圈直接调用showLoading(false);
                showLoading(true);
                /*
                 2019年12月20日
                 1、组装参数
                 2、获取企业信息
                 */
                var companyType = $("input[name='companyType']:checked").val(); // 单位类型

                var uniscid = $('#userName').val();
                var companyName2 = $('#companyName').val();
                var formData = new FormData();
                formData.append("otherParam",'{"orgno":"'+uniscid+'","entname":"'+companyName2+'"}');
                formData.append("busiCode","xxx");
                formData.append("certCode","tj_scw_cer_007");
                formData.append("itemCode","xxx");

                var isFlag = true;
                $.ajax({
                    type: "POST",
                    url: "http://60.28.163.53:9000/yztb/rest/certificate",
                    data: formData,
                    contentType:false,
                    processData:false,
                    dataType: "json",
                    success: function (result) {
                        isFlag = result.certs[0].certData.indexOf("存续")>1;
                        var starNum = uniscid.substring(0,1);

                        if(starNum!=9){
                            isFlag = true;
                        }


                        /*
                         2019年12月24日
                         如果企业不是“存续”状态，不允许注册
                         */
                        if(!isFlag){
                            //layer.alert("统一社会信用代码、企业名称不对，请输入准确的信息；或者企业不是存续状态，不能注册！请核对信息。");

                            //询问框
                            var index = layer.confirm('统一社会信用代码、企业名称不对，请输入准确的信息；或者企业不是存续状态，不能注册！请核对信息。', {
                                btn: ['确定', '取消'] //按钮
                            }, function () {
                                window.open("${rc.contextPath}/sys/register.html");
                                layer.close(index);
                            }, function () {
                                layer.close(index);
                            });

                            return false;
                        }
                        if(starNum==9){
                            var kk;
                            var scw = result.certs[0].certData;
                            kk = JSON.parse(result.certs[0].certData.substr(1,scw.length-2));

                            companyInfo["apprdate"] = kk.apprdate;
                            companyInfo["dom"] = kk.dom;
                            companyInfo["entname"] = kk.entname;
                            companyInfo["enttype"] = kk.enttype;
                            companyInfo["estdate"] = kk.estdate;
                            companyInfo["lerep"] = kk.lerep;
                            companyInfo["opfrom"] = kk.opfrom;
                            companyInfo["opscope"] = kk.opscope;
                            companyInfo["opto"] = kk.opto;
                            companyInfo["regcap"] = kk.regcap;
                            companyInfo["regcapcur"] = kk.regcapcur;
                            companyInfo["regno"] = kk.regno;
                            companyInfo["regorg"] = kk.regorg;
                            companyInfo["regstate"] = kk.regstate;
                            companyInfo["orgno"] = kk.orgno;
                            companyInfo["compform"] = kk.compform;
                        }
                        /*
                        验证经办人的有效性；
                        1、先通过接口《互联互通公安接口文档》中的请求地址：http://60.28.163.53:9002/yztb/rest/police
                           请求参数：身份证号、姓名、手机号
                           返回参数：用户ID、身份证号
                        2、通过第 1 步获得的返回参数，通过接口：公安全国人口库接口，获取申请人的详细信息；
                        3、通过验证后，返回成功的status，允许申请人注册；
                         */
                        var operator = $('#operator').val();
                        var operatorMobile = $('#operatorMobile').val();
                        var idCardNumber_1 = $('#idCardNumber_1').val();

                        var formDataPerson = new FormData();
                        formDataPerson.append("busiCode","xxx");
                        formDataPerson.append("cerNo","xxx");
                        formDataPerson.append("certCode","tj_gaj_cer_098");
                        formDataPerson.append("itemCode","xxx");
                        formDataPerson.append("institution","xxx");
                        formDataPerson.append("method","getUserRegistration");
                        formDataPerson.append("otherParam",'{"id_card":"'+idCardNumber_1+'","phone":"'+operatorMobile+'","name":"'+operator+'"}');
                        $.ajax({
                            type:"POST",
                            url:"http://60.28.163.53:9002/yztb/rest/police",
                            data:formDataPerson,
                            contentType:false,
                            processData:false,
                            dataType: "json",
                            success: function (result) {
                                // 开始注册
                                $.ajax({
                                    type: "POST",
                                    url: "${rc.contextPath}/companyInfo/register",
                                    data: {"companyInfo": JSON.stringify(companyInfo), "captcha": captcha},
                                    dataType: "json",
                                    success: function (result) {
                                        if (result.code == 0) {//注册成功
                                            showLoading(false);
                                            parent.location.href = '../login.html';
                                        } else {
                                            var index = layer.confirm(result.message,{
                                                btn: ['确认', '取消'] //按钮
                                            },function () {
                                                layer.alert(result.message);

                                                refreshCode();
                                                window.open("${rc.contextPath}/systemNotice/systemNotice.html");// 跳转到重要通知页面
                                            },function () {
                                                layer.alert(result.message);
                                                window.open("${rc.contextPath}/systemNotice/systemNotice.html");// 跳转到重要通知页面
                                            });

                                        }
                                    }
                                });
                                //var isTrue = result.data.data.id_card==idCardNumber_1;

//                                var user_id = result.data.data.user_id;
//                                var formDataGongan = new FormData();
//                                formDataGongan.append("busiCode","xxx");
//                                formDataGongan.append("cerNo","xxx");
//                                formDataGongan.append("certCode","tj_gaj_cer_151");
//                                formDataGongan.append("itemCode","xxx");
//                                formDataGongan.append("Institution","xxx");
//                                formDataGongan.append("method","nationwidePopulationLibrary");
//                                formDataGongan.append("otherParam",'{"idcard":"'+idCardNumber_1+'","user_id":"'+user_id+'"}');
                                /*$.ajax({
                                    type:"POST",
                                    url:"http://60.28.163.53:9002/yztb/rest/police",
                                    data:formDataGongan,
                                    contentType:false,
                                    processData:false,
                                    dataType: "json",
                                    success: function (result) {

                                        if(result.data.status==0){
                                            // 开始注册
                                            $.ajax({
                                                type: "POST",
                                                url: "${rc.contextPath}/companyInfo/register",
                                                data: {"companyInfo": JSON.stringify(companyInfo), "captcha": captcha},
                                                dataType: "json",
                                                success: function (result) {
                                                    if (result.code == 0) {//注册成功
                                                        showLoading(false);
                                                        parent.location.href = '../login.html';
                                                    } else {
                                                        layer.alert(result.message);

                                                        refreshCode();
                                                        window.open("${rc.contextPath}/systemNotice/systemNotice.html");// 跳转到重要通知页面
                                                    }
                                                }
                                            });
                                        }else {
                                            layer.alert("经办人姓名与身份证号不一致，请确保一致！");
                                            return false;
                                        }

                                    }
                                });*/

                            }
                        });

                    }
                });

            }
        });
    });

    function checkSocialCreditCode(Code) {
        var patrn = /^[0-9A-Z]+$/;//18位校验及大写校验

        if ((Code.length != 18) || (patrn.test(Code) == false)) {
            layer.alert("不是有效的统一社会信用代码！");
            return false;
        } else {
            var Ancode; //统一社会信用代码的每一个值

            var Ancodevalue; //统一社会信用代码每一个值的权重

            var total = 0;
            var weightedfactors = [1, 3, 9, 27, 19, 26, 16, 17, 20, 29, 25, 13, 8, 24, 10, 30, 28]; //加权因子

            var str = '0123456789ABCDEFGHJKLMNPQRTUWXY';//不用I、O、S、V、Z

            for (var i = 0; i < Code.length - 1; i++) {
                Ancode = Code.substring(i, i + 1);
                Ancodevalue = str.indexOf(Ancode);
                total = total + Ancodevalue * weightedfactors[i];//权重与加权因子相乘之和
            }
            var logiccheckcode = 31 - total % 31;


            if (logiccheckcode == 31) {
                logiccheckcode = 0;
            }
            var Str = "0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,G,H,J,K,L,M,N,P,Q,R,T,U,W,X,Y";
            var Array_Str = Str.split(',');
            logiccheckcode = Array_Str[logiccheckcode];


            var checkcode = Code.substring(17, 18);
            if (logiccheckcode != checkcode) {
                layer.alert("不是有效的统一社会信用代码！");
                return false;
            }
        }

        return true;
    }

    function _updateFileChange(fileObj) {
        $.ajaxFileUpload({
            url: '${rc.contextPath}/fileUpload/uploadImage/businessLicense',
            fileElementId: fileObj.attr("id"),
            type: 'post',
            dataType: 'text',
            obj: fileObj,
            success: function (result, status, obj) {
                var resultObj = JSON.parse(result);
                if (!resultObj.code) {
                    $("input[name=" + obj.attr("attr-inp") + "]").val(resultObj.data.attachmentUrl);
                } else {
                    layer.msg(resultObj.message);
                }
            },
            error: function (result, status, e) {
                layer.msg("图片上传失败");
            }
        });
    }

    function changeImg(object) {
        integral.change(object);
        _updateFileChange($(object));
    }
    var opts = {
        lines: 9, // The number of lines to draw
        length: 0, // The length of each line
        width: 10, // The line thickness
        radius: 15, // The radius of the inner circle
        corners: 1, // Corner roundness (0..1)
        rotate: 0, // The rotation offset
        color: '#fff', // #rgb or #rrggbb
        speed: 1, // Rounds per second
        trail: 60, // Afterglow percentage
        shadow: false, // Whether to render a shadow
        hwaccel: false, // Whether to use hardware acceleration
        className: 'spinner', // The CSS class to assign to the spinner
        zIndex: 2e9, // The z-index (defaults to 2000000000)
        top: '400px', // Top position relative to parent in px
        left: '900px' // Left position relative to parent in px
    };
    var spinner = new Spinner(opts);
    //显示与隐藏加载动画
    function showLoading(result) {
        var spinContainer = document.getElementById("foo");
        if (result) {
            var target = $(spinContainer).get(0);
            spinner.spin(target);
            spinContainer.style.height = document.documentElement.clientHeight + "px";
            $(spinContainer).show();
        } else {
            spinner.spin();
            $(spinContainer).hide();
        }
    }
</script>
<style type="text/css">
    .integral-businesslicense-img {
        width: 180px;
        height: 158px;
        float: left;
        background: #FBFCFF;
        text-align: center;
        border: 1px solid #DDDDDD;
        padding: 10px;
        margin-right: 10px;
        position: relative;
    }
    #foo {
        position: fixed;
        left: 0;
        top: 0;
        _position: absolute;
        width: 100%;
        background: #000;
        opacity: 0.5;
        filter: alpha(opacity=50);
        z-index: 999;
        display: none;
    }
</style>
</html>
