<!DOCTYPE html>
<html lang="cn">

<title>用户注册</title>
#parse("common/header.html")
</head>

<body>
<!-- banner和title部分 -->
#parse("common/banner.html")

<!-- 主体部分 -->
<div class="integral-main-box">
    <!-- 内容展示区  登录和注册等不带导航模块需要加 样式 ”cont-center“-->
    <div class="integral-cont ml105">
        <!-- 网上注册 -->
        <!-- 示例title 面包屑导航 -->
        <div class="integral-grey-title-bar">
            <div class="title-bar-head title-bar-yhzc">用户注册</div>
        </div>
        <!-- 内容描述title -->
        <div class="integral-desc-title">
            网上注册
        </div>
        <!-- 示例title2 二级标题 -->
        <div class="integral-grey-title-bar title-bar2">
            <div class="title-bar-head title-bar-wszc">网上注册信息</div>
        </div>
        <form id="companyForm">
            <!-- 用户注册表格 -->
            <div class="integral-cont-table-wrap">
                <table class="integral-cont-table">
                    <tr>
                        <td></td>
                        <td>
                            <span class="color-red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;提示：请在电脑上操作，不要在手机上操作。</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>用&nbsp; 户 &nbsp;名：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="userName" name="userName"
                                   placeholder="请使用英文或数字，6–20位，请注意区分大小写" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="password" name="password"
                                   placeholder="请使用5--12位" type="password">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>确认密码：
                        </td>
                        <td>
                            <input class="integral-input w450 ml50" id="passwordConfirm" name="passwordConfirm"
                                   placeholder="请再输入一遍您上面填写的密码" type="password">
                        </td>
                    </tr>
                </table>
            </div>
            <!-- 示例title2 二级标题 -->
            <div class="integral-grey-title-bar title-bar2">
                <div class="title-bar-head title-bar-dwjb">申请单位基本信息</div>
            </div>
            <!-- 事业单位基本信息表格 -->
            <div class="integral-cont-table-wrap">
                <table class="integral-cont-table">
                    <tr>
                        <td></td>
                        <td>
                            <span class="color-red">提示：单位名称与统一社会信用代码保存成功后不可更改</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>单位名称：
                        </td>
                        <td>
                            <input class="integral-input w450" id="companyName" name="companyName"
                                   placeholder="单位名称必须与营业执照一致" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>单位类型：
                        </td>
                        <td>
                            <input class="input_radio" type="radio" name="companyType" value="1" id="causeCompany">&nbsp;&nbsp;&nbsp;
                            <label for="causeCompany">企事业单位</label>
                            <input class="input_radio ml30" type="radio" name="companyType" value="2"
                                   id="simpleCompany">&nbsp;&nbsp;&nbsp;
                            <label for="simpleCompany">个体工商户</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>统一社会信用代码：
                        </td>
                        <td>
                            <input class="integral-input w450" id="societyCode" name="societyCode"
                                   placeholder="18位统一社会信用代码必须与营业执照一致" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>申报单位统一社会信用<br/>代码营业执照副本原件：
                        </td>
                        <td>
                            <div class="integral-businesslicense-img">
                                <img class="addImg pointer"
                                     src="${rc.contextPath}/$static.curr_ver()/img/yingyezhizhao.png"
                                     onclick="integral.clickImg(this);">
                                <img class="preview" id="preview" alt="" name="pic" width="160" height="220"
                                     style="display: none"/>
                                <input id="business_license" name="business_license" type="file"
                                       class="upload_input" accept="image/*"
                                       onchange="changeImg(this)" attr-inp="businessLicenseSrc"/>
                                <div class="pointer title_click" onclick="integral.clickImg(this);">
                                    点击上传营业执照原件
                                </div>
                                <div class="title_idcard" style="display:none;">营业执照</div>
                                <div class="del_idcard" onclick="integral.deleteImg(this)"
                                     style="display:none;"></div>
                                <input id="businessLicenseSrc" name="businessLicenseSrc"
                                       type="hidden" value=""/>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>单位联系电话：
                        </td>
                        <td>
                            <input class="integral-input w450" id="companyMobile" name="companyMobile"
                                   placeholder="请输入11位手机号" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style="line-height:20px;padding-top:20px;">
                        <span class="color-red">提示：1、申报单位经办人与申请人社会保险缴费应为同一单位，拟落集体户口的除外；
                            <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2、保存成功后，每开办一期可以修改一次用人单位信息；
                            <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3、现场办理时，窗口核验经办人身份证原件。
                        </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人1：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operator" name="operator" placeholder="如：张三"
                                   type="text">
                        </td>
                    </tr>
                    <!--<tr>
                        <td></td>
                        <td>
                            <span class="color-red">*请填写真实可用的手机号码，注册成功后，系统会通过短信方式发送登录确认码</span>
                        </td>
                    </tr>-->
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人1联系手机：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operatorMobile" name="operatorMobile"
                                   placeholder="请输入11位手机号码" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人1身份证号：
                        </td>
                        <td>
                            <input class="integral-input w450" id="idCardNumber_1" name="idCardNumber_1"
                                   placeholder="请输入身份证号" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人2：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operator2" name="operator2" placeholder="如：李四"
                                   type="text">
                        </td>
                    </tr>
                    <!--<tr>
                        <td></td>
                        <td>
                            <span class="color-red">*请填写真实可用的手机号码，注册成功后，系统会通过短信方式发送登录确认码</span>
                        </td>
                    </tr>-->
                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人2联系手机：
                        </td>
                        <td>
                            <input class="integral-input w450" id="operatorMobile2" name="operatorMobile2"
                                   placeholder="请输入11位手机号码" type="text">
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="color-red">*</span>经办人2身份证号：
                        </td>
                        <td>
                            <input class="integral-input w450" id="idCardNumber_2" name="idCardNumber_2"
                                   placeholder="请输入身份证号" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>联系地址：
                        </td>
                        <td>
                            <input class="integral-input w450" placeholder="" id="operatorAddress"
                                   name="operatorAddress" type="text">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="color-red">*</span>验证码：
                        </td>
                        <td>
                            <input class="integral-input w200" type="text" id="captcha" name="captcha">
                            <div class="checkimg"><img id="captchaImg" src="${rc.contextPath}/captcha.jpg" alt="看不清点我"
                                                       class="click_me"></div>
                            <span class="click_me">看不清点我</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div class="color-red">*注：标有红色 * 为必填项</div>
                        </td>
                    </tr>
                </table>
            </div>
        </form>

        <!-- 登录按钮 -->
        <div class="integral-bottom-btn-group mt150">
            <div class="interal-main-btn big-btn m15" id="register">注册</div>
            <div class="interal-main-btn big-btn interal-main-btn2 ml50" id="cancel">返回</div>
        </div>
    </div>
</div>

<!-- 底部栏 footer -->
#parse("common/footer.html")
</body>
<script type="text/javascript">

    //点击注册按钮
    //    $("#register").on("click", function(){
    //        $("#companyForm").submit();
    //    });

    //点击注册按钮，2018年7月18日，添加提示
    $("#register").on("click", function () {
        if ($('#userName').val().indexOf(" ") !== -1) {
            layer.alert("用户名中不能有空格！");
        } else if ($('#businessLicenseSrc').val().trim() == "") {
            layer.alert("请上传营业执照照片！");
        } else {
            var index = layer.confirm('一旦注册成功，本期不可修改，确定要注册吗？', {
                btn: ['确认', '取消']
            }, function () {
                $("#companyForm").submit();
                layer.close(index);
            }, function () {
                layer.close(index);
            });
        }
    });


    $("#submitAndContinue").on("click", function () {
        //询问框
        var index = layer.confirm('确定要保存并继续录入申请人吗？', {
            btn: ['确认', '取消'] //按钮
        }, function () {
            submitAndContinue();
            layer.close(index);
        }, function () {
            layer.close(index);
        });
    });

    $(function () {
        $("#companyForm").validate({
            rules: {
                userName: {
                    required: true,
                    minlength: 6,
                    maxlength: 20
                },
                password: {
                    required: true,
                    minlength: 5,
                    maxlength: 12
                },
                passwordConfirm: {
                    required: true,
                    minlength: 5,
                    equalTo: "#password"
                },
                companyName: {
                    required: true,
                    maxlength: 100
                },
                societyCode: {
                    required: true,
                    maxlength: 50
                },
                companyMobile: {
                    required: true,
                    isMobile: true
                },
                operator: {
                    required: true,
                    maxlength: 10
                },
                operator2: {
                    required: true,
                    maxlength: 10
                },
                operatorMobile: {
                    required: true,
                    isMobile: true
                },
                operatorMobile2: {
                    required: true,
                    isMobile: true
                },
                idCardNumber_1: {
                    required: true,
                    isIdCardNo: true
                },
                idCardNumber_2: {
                    required: true,
                    isIdCardNo: true
                },
                operatorAddress: {
                    required: true,
                    maxlength: 100
                }
            },
            messages: {
                userName: {
                    required: "请输入用户名",
                    minlength: "用户名最少由 6 个字母组成",
                    maxlength: "用户名最多由 20 个字母组成"
                },
                password: {
                    required: "请输入密码",
                    minlength: "用户名最少由 5 个字母组成",
                    maxlength: "用户名最多由 12 个字母组成"
                },
                passwordConfirm: {
                    required: "请输入密码",
                    minlength: "密码长度不能小于 5 个字母",
                    equalTo: "两次密码输入不一致"
                },
                companyName: {
                    required: "请输入单位名称",
                    maxlength: "单位名称不能大于 100 个字母"
                },
                societyCode: {
                    required: "请输入统一社会信用代码",
                    maxlength: "密码长度不能大于 50 个字母"
                },
                companyMobile: {
                    required: "请输入单位联系电话"
                },
                operator: {
                    required: "经办人的社保缴纳单位与申请人一致",
                    maxlength: "密码长度不能大于 10 个字母"
                },
                operator2: {
                    required: "经办人的社保缴纳单位与申请人一致",
                    maxlength: "密码长度不能大于 10 个字母"
                },
                operatorMobile: {
                    required: "请输入联系手机"
                },
                operatorMobile2: {
                    required: "请输入联系手机"
                },
                idCardNumber_1: {
                    required: "请输入身份证号"
                },
                idCardNumber_2: {
                    required: "请输入身份证号"
                },
                operatorAddress: {
                    required: "请输入联系地址",
                    maxlength: "密码长度不能大于 100 个字母"
                }
            },

            submitHandler: function (form) {
                var companyInfo = serializeForm($("#companyForm"));
                var captcha = companyInfo['captcha'];
                //移除元素
                delete companyInfo['passwordConfirm'];
                delete companyInfo['captcha'];

                var societyCode = $("input[name=societyCode]").val();
                if (!checkSocialCreditCode(societyCode)) {
                    return false;
                }

                $.ajax({
                    type: "POST",
                    url: "${rc.contextPath}/companyInfo/register",
                    data: {"companyInfo": JSON.stringify(companyInfo), "captcha": captcha},
                    dataType: "json",
                    success: function (result) {
                        if (result.code == 0) {//注册成功
                            parent.location.href = '../login.html';
                        } else {
                            layer.alert(result.message);

                            refreshCode();
                        }
                    }
                });
            }
        });
    });

    function checkSocialCreditCode(Code) {
        var patrn = /^[0-9A-Z]+$/;//18位校验及大写校验

        if ((Code.length != 18) || (patrn.test(Code) == false)) {
            layer.alert("不是有效的统一社会信用代码！");
            return false;
        } else {
            var Ancode; //统一社会信用代码的每一个值

            var Ancodevalue; //统一社会信用代码每一个值的权重

            var total = 0;
            var weightedfactors = [1, 3, 9, 27, 19, 26, 16, 17, 20, 29, 25, 13, 8, 24, 10, 30, 28]; //加权因子

            var str = '0123456789ABCDEFGHJKLMNPQRTUWXY';//不用I、O、S、V、Z

            for (var i = 0; i < Code.length - 1; i++) {
                Ancode = Code.substring(i, i + 1);
                Ancodevalue = str.indexOf(Ancode);
                total = total + Ancodevalue * weightedfactors[i];//权重与加权因子相乘之和
            }
            var logiccheckcode = 31 - total % 31;


            if (logiccheckcode == 31) {
                logiccheckcode = 0;
            }
            var Str = "0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,G,H,J,K,L,M,N,P,Q,R,T,U,W,X,Y";
            var Array_Str = Str.split(',');
            logiccheckcode = Array_Str[logiccheckcode];


            var checkcode = Code.substring(17, 18);
            if (logiccheckcode != checkcode) {
                layer.alert("不是有效的统一社会信用代码！");
                return false;
            }
        }

        return true;
    }

    function _updateFileChange(fileObj) {
        $.ajaxFileUpload({
            url: '${rc.contextPath}/fileUpload/uploadImage/businessLicense',
            fileElementId: fileObj.attr("id"),
            type: 'post',
            dataType: 'text',
            obj: fileObj,
            success: function (result, status, obj) {
                var resultObj = JSON.parse(result);
                if (!resultObj.code) {
                    $("input[name=" + obj.attr("attr-inp") + "]").val(resultObj.data.attachmentUrl);
                } else {
                    layer.msg(resultObj.message);
                }
            },
            error: function (result, status, e) {
                layer.msg("图片上传失败");
            }
        });
    }

    function changeImg(object) {
        integral.change(object);
        _updateFileChange($(object));
    }
</script>
<style type="text/css">
    .integral-businesslicense-img {
        width: 180px;
        height: 268px;
        float: left;
        background: #FBFCFF;
        text-align: center;
        border: 1px solid #DDDDDD;
        padding: 10px;
        margin-right: 10px;
        position: relative;
    }
</style>
</html>
