<!DOCTYPE html>
<html lang="en">
<head>
    <title>首页</title>
    #parse("common/header.html")
</head>

<body>
#parse("common/banner.html")

<!-- 主体部分 -->
<div class="integral-main-box">

    <!-- 左部导航 -->
    #parse("common/lefter.html")
    <!-- </script> -->
    <!-- 中间二级导航 -->

    <!-- 内容展示区 -->
    <div class="integral-cont">

        <!-- 示例title 面包屑导航 -->
        <div class="integral-grey-title-bar">
            <div class="title-bar-head">居住证积分</div>
            <div class="title-bar-after">申请人列表</div>
        </div>
        <!-- 内容描述title -->
        <div class="integral-desc-title">
            申请人列表
        </div>
        <!-- 表格搜索框和按钮部分 -->
        <div id="app">
            <script type="template/regular" id="identityRows">
                <div class="interal-tab-title-input">
                    <div class="interal-input-title">快速查询</div>
                    <input type="text" name="queryStr">
                    <div class="interal-input-btn" on-click={this.load()}>查询</div>
                    <div class="interal-input-btn">返回</div>
                    <div class="interal-input-btn" id="addApplication">添加申请人</div>
                    <div class="interal-input-btn">批量预约</div>
                </div>
                <!-- table2表格部分 -->
                <table class="integral-table">
                    <tr>
                        <th>选择</th>
                        <th>序列</th>
                        <th>身份证号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>拟定户地</th>
                        <th>预约日期</th>
                        <th>操作</th>
                    </tr>
                    {#list identityInfos as identityInfo }
                    <tr>
                        <td>
                            <input type="checkbox">
                        </td>
                        <td>{identityInfo.id}</td>
                        <td>{identityInfo.idNumber}</td>
                        <td>{identityInfo.name}</td>
                        <td>{identityInfo.sexStr}</td>
                        <td>{identityInfo.regionName}</td>
                        <td>2016-08-02</td>
                        <td>
                            <span class="integral-table-btn integral-table-btn1">编辑</span>
                            <span class="integral-table-btn integral-table-btn2">测评</span>
                        </td>
                    </tr>
                    {/list}
                </table>
            </script>
        </div>
        <!-- 分页器插件 -->
        <div class="integral-paging-device-wrap2 m-style"></div>
    </div>
</div>

<!-- 底部栏 footer -->
#parse("common/footer.html")
</body>
<script type="text/javascript">
    $(function(){
        $("#addApplication").on("click", function(){
            window.open("${rc.contextPath}/identityInfo/toAddIdentityInfo");
        });
    });

    //利用Regular构建你的app吧
    var identityRowsRegular = Regular.extend({
        template: '#identityRows'
    });

    // initialize component then $inject to #app's  bottom
    var component = new identityRowsRegular({
        data: {identityInfos: []},
        load: function(data){
            var queryStr = $("input[name=queryStr]").val();

            if(queryStr == undefined) {
                queryStr = "";
            }
            $.ajax({
                type: "POST",
                url: "${rc.contextPath}/identityInfo/list",
                data: {"queryStr": queryStr},
                dataType: "json",
                success: function(result){
                    var resultData = result.data;
                    if(result.code == 0){//登录成功

                        component.data.identityInfos = resultData.data;
                        component.$update();

                        $(".integral-paging-device-wrap2").pagination({pageCount: resultData.recordsTotal});
                    }else{
                        layer.alert(result.message);
                    }
                }
            });
        }
    });

    component.load();

    component.$inject('#app');
</script>

</html>

